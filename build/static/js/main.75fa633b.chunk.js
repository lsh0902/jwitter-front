(this["webpackJsonpdwitter-app"]=this["webpackJsonpdwitter-app"]||[]).push([[0],{123:function(e,t,n){"use strict";n.r(t);var r=n(1),a=n.n(r),c=n(64),s=n.n(c),u=(n(70),n(3)),o=n(0),i=Object(r.memo)((function(e){var t=e.username,n=e.onLogout,r=e.onMyTweets,a=e.onAllTweets;return Object(o.jsxs)("header",{className:"header",children:[Object(o.jsxs)("div",{className:"logo",children:[Object(o.jsx)("img",{src:"./img/logo.png",alt:"Dwitter Logo",className:"logo-img"}),Object(o.jsx)("h1",{className:"logo-name",children:"Jwitter"}),t&&Object(o.jsxs)("span",{className:"logo-user",children:["@",t]})]}),t&&Object(o.jsxs)("nav",{className:"menu",children:[Object(o.jsx)("button",{onClick:a,children:"All Tweets"}),Object(o.jsx)("button",{onClick:r,children:"My Tweets"}),Object(o.jsx)("button",{className:"menu-item",onClick:n,children:"Logout"})]})]})})),l=n(37),h=n(4),j=Object(r.memo)((function(e){var t=e.text,n=e.isAlert;return Object(o.jsx)(o.Fragment,{children:t&&Object(o.jsx)("p",{className:"banner ".concat(n?"banner-red":"banner-green"),children:t})})})),f=n(2),b=n.n(f),p=n(6),d=function(e){var t=e.tweetService,n=e.onError,a=(e.onCreated,Object(r.useState)("")),c=Object(h.a)(a,2),s=c[0],u=c[1],i=function(){var e=Object(p.a)(b.a.mark((function e(r){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r.preventDefault(),t.postTweet(s).then((function(e){u("")})).catch(n);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(o.jsxs)("form",{className:"tweet-form",onSubmit:i,children:[Object(o.jsx)("input",{type:"text",placeholder:"Edit your tweet",value:s,required:!0,autoFocus:!0,onChange:function(e){u(e.target.value)},className:"form-input tweet-input"}),Object(o.jsx)("button",{type:"submit",className:"form-btn",children:"Post"})]})};function m(e){var t=new Date(Date.parse(e)),n=new Date,r=Math.floor((n-t)/1e3);if(r<=1)return"just now";if(r<20)return r+" seconds ago";if(r<40)return"half a minute ago";if(r<60)return"less than a minute ago";if(r<=90)return"one minute ago";if(r<=3540)return Math.round(r/60)+" minutes ago";if(r<=5400)return"1 hour ago";if(r<=86400)return Math.round(r/3600)+" hours ago";if(r<=129600)return"1 day ago";if(r<604800)return Math.round(r/86400)+" days ago";if(r<=777600)return"1 week ago";var a=t.toLocaleDateString("default",{month:"long"});return"on ".concat(a," ").concat(t.getDate())}var O=Object(r.memo)((function(e){var t=e.url,n=e.name;return Object(o.jsx)("div",{children:t?Object(o.jsx)("img",{src:t,alt:"avatar",className:"avatar-img"}):Object(o.jsx)("div",{className:"avatar-txt",children:n.charAt(0)})})})),v=function(e){var t=e.tweet,n=e.onUpdate,a=e.onClose,c=Object(r.useState)(t.text),s=Object(h.a)(c,2),u=s[0],i=s[1],l=function(){var e=Object(p.a)(b.a.mark((function e(r){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r.preventDefault(),n(t.id,u),a();case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return Object(o.jsxs)("form",{className:"edit-tweet-form",onSubmit:l,children:[Object(o.jsx)("input",{type:"text",placeholder:"Edit your tweet",value:u,required:!0,autoFocus:!0,onChange:function(e){i(e.target.value)},className:"form-input tweet-input"}),Object(o.jsxs)("div",{className:"edit-tweet-form-action",children:[Object(o.jsx)("button",{type:"submit",className:"form-btn-update",children:"Update"}),Object(o.jsx)("button",{type:"button",className:"form-btn-cancel",onClick:a,children:"Cancel"})]})]})},w=Object(r.memo)((function(e){var t=e.tweet,n=e.owner,a=e.onDelete,c=e.onUpdate,s=e.onUsernameClick,u=t.id,i=t.username,l=t.name,j=t.url,f=t.text,b=t.createdAt,p=Object(r.useState)(!1),d=Object(h.a)(p,2),w=d[0],x=d[1];return Object(o.jsxs)("li",{className:"tweet",children:[Object(o.jsxs)("section",{className:"tweet-container",children:[Object(o.jsx)(O,{url:j,name:l}),Object(o.jsxs)("div",{className:"tweet-body",children:[Object(o.jsx)("span",{className:"tweet-name",children:l}),Object(o.jsxs)("span",{className:"tweet-username",onClick:function(){return s(t)},children:["@",i]}),Object(o.jsxs)("span",{className:"tweet-date",children:[" \xb7 ",m(b)]}),Object(o.jsx)("p",{children:f}),w&&Object(o.jsx)(v,{tweet:t,onUpdate:c,onClose:function(){return x(!1)}})]})]}),n&&Object(o.jsxs)("div",{className:"tweet-action",children:[Object(o.jsx)("button",{className:"tweet-action-btn",onClick:function(){return a(u)},children:"x"}),Object(o.jsx)("button",{className:"tweet-action-btn",onClick:function(){return x(!0)},children:"\u270e"})]})]})})),x=n(16),g=n(17),k=function(e){var t=e.onSignUp,n=e.onLogin,a=Object(r.useState)(!1),c=Object(h.a)(a,2),s=c[0],u=c[1],i=Object(r.useState)(""),l=Object(h.a)(i,2),f=l[0],b=l[1],p=Object(r.useState)(""),d=Object(h.a)(p,2),m=d[0],O=d[1],v=Object(r.useState)(""),w=Object(h.a)(v,2),x=w[0],g=w[1],k=Object(r.useState)(""),y=Object(h.a)(k,2),S=y[0],N=y[1],C=Object(r.useState)(""),E=Object(h.a)(C,2),T=E[0],I=E[1],U=Object(r.useState)(""),A=Object(h.a)(U,2),D=A[0],L=A[1],M=Object(r.useState)(!1),F=Object(h.a)(M,2),B=F[0],q=F[1],z=function(e){L(e.toString()),q(!0)},P=function(e){var t=e.target,n=t.name,r=t.value,a=t.checked;switch(n){case"username":return b(r);case"password":return O(r);case"name":return g(r);case"email":return N(r);case"url":return I(r);case"signup":return u(a)}};return Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)(j,{text:D,isAlert:B}),Object(o.jsxs)("form",{className:"auth-form",onSubmit:function(e){e.preventDefault(),s?t(f,m,x,S,T).catch(z):n(f,m).catch(z)},children:[Object(o.jsx)("input",{name:"username",type:"text",placeholder:"Id",value:f,onChange:P,className:"form-input",required:!0}),Object(o.jsx)("input",{name:"password",type:"password",placeholder:"Password",value:m,className:"form-input",onChange:P}),s&&Object(o.jsx)("input",{name:"name",type:"text",placeholder:"Name",value:x,onChange:P,className:"form-input",required:!0}),s&&Object(o.jsx)("input",{name:"email",type:"email",placeholder:"Email",value:S,onChange:P,className:"form-input",required:!0}),s&&Object(o.jsx)("input",{name:"url",type:"url",placeholder:"Profile Image URL",value:T,onChange:P,className:"form-input"}),Object(o.jsxs)("div",{className:"form-signup",children:[Object(o.jsx)("input",{name:"signup",id:"signup",type:"checkbox",onChange:P,checked:s}),Object(o.jsx)("label",{htmlFor:"signup",children:" Create a new account?"})]}),Object(o.jsx)("button",{className:"form-btn auth-form-btn",type:"submit",children:s?"Sign Up":"Sign In"})]})]})},y=Object(r.createContext)({}),S=Object(r.createRef)();function N(e){var t=e.authService,n=e.authErrorEventBus,a=e.children,c=Object(r.useState)(void 0),s=Object(h.a)(c,2),u=s[0],l=s[1];Object(r.useImperativeHandle)(S,(function(){return u?u.token:void 0})),Object(r.useEffect)((function(){n.listen((function(e){console.log(e),l(void 0)}))}),[n]),Object(r.useEffect)((function(){t.me().then(l).catch(console.error)}),[t]);var j=Object(r.useCallback)(function(){var e=Object(p.a)(b.a.mark((function e(n,r,a,c,s){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.signup(n,r,a,c,s).then((function(e){return l(e)})));case 1:case"end":return e.stop()}}),e)})));return function(t,n,r,a,c){return e.apply(this,arguments)}}(),[t]),f=Object(r.useCallback)(function(){var e=Object(p.a)(b.a.mark((function e(n,r){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.login(n,r).then((function(e){return l(e)})));case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),[t]),d=Object(r.useCallback)(Object(p.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",t.logout().then((function(){return l(void 0)})));case 1:case"end":return e.stop()}}),e)}))),[t]),m=Object(r.useMemo)((function(){return{user:u,signUp:j,logIn:f,logout:d}}),[u,j,f,d]);return Object(o.jsx)(y.Provider,{value:m,children:u?a:Object(o.jsxs)("div",{className:"app",children:[Object(o.jsx)(i,{}),Object(o.jsx)(k,{onSignUp:j,onLogin:f})]})})}var C=function(){function e(){Object(x.a)(this,e)}return Object(g.a)(e,[{key:"listen",value:function(e){this.callback=e}},{key:"notify",value:function(e){this.callback(e)}}]),e}(),E=function(){return Object(r.useContext)(y)},T=Object(r.memo)((function(e){var t=e.tweetService,n=e.username,a=e.addable,c=Object(r.useState)([]),s=Object(h.a)(c,2),i=s[0],f=s[1],b=Object(r.useState)(""),p=Object(h.a)(b,2),m=p[0],O=p[1],v=Object(u.f)(),x=E().user;Object(r.useEffect)((function(){t.getTweets(n).then((function(e){return f(Object(l.a)(e))})).catch(N);var e=t.onSync((function(e){return g(e)}));return function(){return e()}}),[t,n,x]);var g=function(e){f((function(t){return[e].concat(Object(l.a)(t))}))},k=function(e){return t.deleteTweet(e).then((function(){return f((function(t){return t.filter((function(t){return t.id!==e}))}))})).catch((function(e){return O(e.toString())}))},y=function(e,n){return t.updateTweet(e,n).then((function(e){return f((function(t){return t.map((function(t){return t.id===e.id?e:t}))}))})).catch((function(e){return e.toString()}))},S=function(e){return v.push("/".concat(e.username))},N=function(e){O(e.toString()),setTimeout((function(){O("")}),3e3)};return Object(o.jsxs)(o.Fragment,{children:[a&&Object(o.jsx)(d,{tweetService:t,onError:N,onCreated:g}),m&&Object(o.jsx)(j,{text:m,isAlert:!0,transient:!0}),0===i.length&&Object(o.jsx)("p",{className:"tweets-empty",children:"No Tweets Yet"}),Object(o.jsx)("ul",{className:"tweets",children:i.map((function(e){return Object(o.jsx)(w,{tweet:e,owner:e.username===x.username,onDelete:k,onUpdate:y,onUsernameClick:S},e.id)}))})]})})),I=function(e){var t=e.tweetService;return Object(o.jsx)(T,{tweetService:t,addable:!0})},U=function(e){var t=e.tweetService,n=Object(u.g)().username;return Object(o.jsx)(T,{tweetService:t,username:n,addable:!1})};var A=function(e){var t=e.tweetService,n=Object(u.f)(),r=E(),a=r.user,c=r.logout;return Object(o.jsxs)("div",{className:"app",children:[Object(o.jsx)(i,{username:a.username,onLogout:function(){window.confirm("Do you want to log out?")&&(c(),n.push("/"))},onAllTweets:function(){n.push("/")},onMyTweets:function(){n.push("/".concat(a.username))}}),Object(o.jsxs)(u.c,{children:["(",Object(o.jsxs)(o.Fragment,{children:[Object(o.jsx)(u.a,{exact:!0,path:"/",children:Object(o.jsx)(I,{tweetService:t})}),Object(o.jsx)(u.a,{exact:!0,path:"/:username",children:Object(o.jsx)(U,{tweetService:t})})]}),")"]})]})},D=n(19),L=n.n(D),M=function(){function e(t,n){Object(x.a)(this,e),console.log(t),this.base=t,this.instance=L.a.create({}),this.storage=n}return Object(g.a)(e,[{key:"login",value:function(){var e=Object(p.a)(b.a.mark((function e(t,n){var r;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.instance.post("".concat(this.base,"/auth/login"),{username:t,password:n}).then((function(e){return e.data})).catch(console.log);case 2:return r=e.sent,this.storage.save(r.token),e.abrupt("return",r);case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"me",value:function(){var e=Object(p.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.instance.get("".concat(this.base,"/auth/me")).then((function(e){return e.data}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"logout",value:function(){var e=Object(p.a)(b.a.mark((function e(){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.storage.clear();case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"signup",value:function(){var e=Object(p.a)(b.a.mark((function e(t,n,r,a,c){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.instance.post("".concat(this.base,"/auth/signup"),{username:t,password:n,name:r,email:a,url:c}).then((function(e){return e.data}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a,c){return e.apply(this,arguments)}}()}]),e}(),F=function(){function e(t,n,r,a){var c=this;Object(x.a)(this,e),this.isExpired=function(e){if(401===e.response.status)return console.log(c),void c.authErrorEventBus.notify(e)},this.instance=L.a.create({baseURL:t}),this.storage=n,this.authErrorEventBus=r,this.socket=a}return Object(g.a)(e,[{key:"setToken",value:function(){this.instance.defaults.headers.common.Authorization=this.storage.get()}},{key:"getTweets",value:function(){var e=Object(p.a)(b.a.mark((function e(){var t,n=arguments;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=n.length>0&&void 0!==n[0]?n[0]:"",console.log(t),e.next=4,this.instance.get("/tweets",{params:{user:t||""},headers:{Authorization:this.storage.get()}}).then((function(e){return e.data})).catch(this.isExpired);case 4:return e.abrupt("return",e.sent);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"postTweet",value:function(){var e=Object(p.a)(b.a.mark((function e(t){var n;return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L.a.post("http://localhost:8080/tweets",{id:Date.now(),createdAt:new Date,userId:1,text:t},{headers:{Authorization:this.storage.get()}}).then((function(e){return e.data})).catch();case 2:return n=e.sent,e.abrupt("return",n);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"deleteTweet",value:function(){var e=Object(p.a)(b.a.mark((function e(t){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L.a.delete("".concat(this.baseUrl,"/tweets/").concat(t),{params:{id:t},headers:{Authorization:this.storage.get()}}).then(console.log);case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"updateTweet",value:function(){var e=Object(p.a)(b.a.mark((function e(t,n){return b.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,L.a.put("".concat(this.baseUrl,"/tweets/").concat(t),{text:n,tweetId:t,headers:{Authorization:this.storage.get()}}).then((function(e){return e.data}));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onSync",value:function(e){return this.socket.onSync("tweets",e)}}]),e}(),B=n(23),q="token",z=function(){function e(){Object(x.a)(this,e)}return Object(g.a)(e,[{key:"save",value:function(e){localStorage.setItem(q,"Bearer "+e)}},{key:"get",value:function(){return localStorage.getItem(q)}},{key:"clear",value:function(){localStorage.clear(q)}}]),e}(),P=n(29),J=n.n(P),R=function(){function e(t,n){Object(x.a)(this,e),this.socketIO=J()(t,{auth:function(e){return e({token:n()})}}),this.socketIO.on("connect_error",(function(e){console.error(e)}))}return Object(g.a)(e,[{key:"onSync",value:function(e,t){var n=this;return this.socketIO.connected||this.socketIO.connect(),this.socketIO.on(e,t),function(){return n.socketIO.off(e)}}}]),e}(),_=new z,H="3.36.59.22:8080",Y=J()(H);Y.on("connect_error",(function(e){console.error(e)})),Y.on("dwitter",(function(e){console.log(" \ub4e3\uace0 \uc774\ub530 !!!! ",e)}));var G=new R(H,(function(){return _.get()}));G.onSync("dwitter",(function(e){console.log(e)}));var K=new C,Q=new M(H,_),V=new F(H,_,K,G);s.a.render(Object(o.jsx)(a.a.StrictMode,{children:Object(o.jsx)(B.a,{children:Object(o.jsx)(N,{authService:Q,authErrorEventBus:K,children:Object(o.jsx)(A,{tweetService:V})})})}),document.getElementById("root"))},70:function(e,t,n){}},[[123,1,2]]]);
//# sourceMappingURL=main.75fa633b.chunk.js.map